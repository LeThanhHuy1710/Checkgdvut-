<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Trang Quản Trị GDV</title>
  <link rel="stylesheet" href="../assets/css/admin.css" />
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.js";

    const SUPABASE_URL = "https://xeidegtzbbiuglgmkbsm.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_XqJzHKum27HwEEzDhxKAqQ_qdoItx4K";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const form = document.querySelector("#formAdd");
    const btnAdd = document.querySelector("#btnAdd");
    const list = document.querySelector("#gdvList .list");

    const inputName = document.querySelector("#name");
    const inputAvatar = document.querySelector("#avatar");
    const inputFacebook = document.querySelector("#facebook");
    const inputFbPhu = document.querySelector("#fb_phu");
    const inputZalo = document.querySelector("#zalo");
    const inputWebsite = document.querySelector("#website");
    const inputBank = document.querySelector("#bank");
    const inputDichVu = document.querySelector("#dichvu");
    const inputTien = document.querySelector("#baohiem");
    const inputNgay = document.querySelector("#ngay");
    const inputNote = document.querySelector("#note");

    let editId = null;

    // Thêm hoặc cập nhật GDV
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = inputName.value.trim();
      if (!name) return alert("❌ Vui lòng nhập tên!");

      const data = {
        name,
        avatar: inputAvatar.value.trim(),
        facebook: inputFacebook.value.trim().replace("https://facebook.com/", ""),
        fb_phu: inputFbPhu.value.trim().replace("https://facebook.com/", ""),
        zalo: inputZalo.value.trim(),
        web: inputWebsite.value.trim(),
        bank: inputBank.value.trim().split("\n"),
        dichvu: inputDichVu.value.trim().split(","),
        baohiem: parseInt(inputTien.value.trim()) || 0,
        ngaybaohiem: inputNgay.value,
        note: inputNote.value.trim(),
        updatedAt: new Date().toISOString()
      };

      try {
        if (editId) {
          const { error } = await supabase
            .from("gdv_list")
            .update(data)
            .eq("id", editId);
          if (error) throw error;
          alert("✅ Cập nhật thành công!
