<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ThÃªm Giao Dá»‹ch ViÃªn</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, textarea, select { display: block; width: 100%; margin-bottom: 10px; padding: 6px; }
    label { font-weight: bold; margin-top: 10px; display: block; }
    .multi-tag { display: flex; flex-wrap: wrap; gap: 5px; }
    .multi-tag label { font-weight: normal; }
    button { padding: 8px 16px; }
  </style>
</head>
<body>
  <h2>â• ThÃªm Giao Dá»‹ch ViÃªn</h2>

  <label>TÃªn GDV</label>
  <input id="name" type="text" placeholder="Nguyá»…n VÄƒn A">

  <label>Link áº¢nh Äáº¡i Diá»‡n</label>
  <input id="avatar" type="url" placeholder="https://example.com/avatar.jpg">

  <label>Facebook chÃ­nh</label>
  <input id="fb_main" type="text" placeholder="ID hoáº·c link">

  <label>Facebook phá»¥</label>
  <input id="fb_sub" type="text" placeholder="ID hoáº·c link (náº¿u cÃ³)">

  <label>Sá»‘ Zalo</label>
  <input id="zalo" type="text" placeholder="vd: 0901234567">

  <label>Website</label>
  <input id="website" type="url" placeholder="https://... (náº¿u cÃ³)">

  <label>NgÃ¢n hÃ ng (viáº¿t sá»‘, khÃ´ng cÃ¡ch)</label>
  <textarea id="bank_accounts" placeholder="Vcb: 1031000000\nAcb: 16219888\nMomo: 0934567643"></textarea>

  <label>Dá»‹ch vá»¥ cung cáº¥p</label>
  <input id="services" type="text" placeholder="CÃ¡ch nhau báº±ng dáº¥u pháº©y, vÃ­ dá»¥: Trung gian, Youtube, MMO">

  <label>Sá»‘ tiá»n báº£o hiá»ƒm (vnÄ‘)</label>
  <input id="insurance_amount" type="number" placeholder="10000000">

  <label>NgÃ y báº¯t Ä‘áº§u báº£o hiá»ƒm</label>
  <input id="insurance_date" type="date">

  <label>Ghi chÃº thÃªm (náº¿u cÃ³)</label>
  <textarea id="note" rows="3"></textarea>

  <button onclick="addGDV()">ThÃªm GDV</button>
  <!-- ThÃªm Ä‘oáº¡n nÃ y sau pháº§n form thÃªm GDV -->
<hr style="margin: 30px 0;">
<h2>ğŸ—‚ Danh sÃ¡ch GDV hiá»‡n táº¡i</h2>
<div id="gdv-list"></div>

<script>
  function loadGDVs() {
    const container = document.getElementById("gdv-list");
    container.innerHTML = "â³ Äang táº£i...";
    db.collection("gdv_list").get().then(snapshot => {
      container.innerHTML = "";
      if (snapshot.empty) {
        container.innerHTML = "<p>ChÆ°a cÃ³ GDV nÃ o.</p>";
        return;
      }

      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement("div");
        div.style = "border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 6px; background: #fff";
        div.innerHTML = `
          <strong>${data.name}</strong><br>
          NgÃ¢n hÃ ng: ${Object.entries(data.bank_accounts || {}).map(([k,v]) => `${k}: ${v}`).join(', ')}<br>
          Dá»‹ch vá»¥: ${(data.services || []).join(', ')}<br>
          <button onclick="deleteGDV('${doc.id}')">âŒ XoÃ¡</button>
        `;
        container.appendChild(div);
      });
    });
  }

  function deleteGDV(id) {
    if (confirm("Báº¡n cháº¯c cháº¯n muá»‘n xoÃ¡ GDV nÃ y?")) {
      db.collection("gdv_list").doc(id).delete()
        .then(() => {
          alert("âœ… ÄÃ£ xoÃ¡ GDV.");
          loadGDVs();
        })
        .catch(err => {
          alert("âŒ Lá»—i khi xoÃ¡: " + err.message);
        });
    }
  }

  // Tá»± Ä‘á»™ng táº£i danh sÃ¡ch khi vÃ o
  loadGDVs();
              </script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDR34V4nSclq1kIMgbnSyMgTMeqUlzFOqo",
      authDomain: "checkgdvut-d2bcc.firebaseapp.com",
      projectId: "checkgdvut-d2bcc",
      storageBucket: "checkgdvut-d2bcc.firebasestorage.app",
      messagingSenderId: "242735289196",
      appId: "1:242735289196:web:cf729b41af26987cb05949",
      measurementId: "G-WLS5PJ4X2G"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function addGDV() {
      const data = {
        name: document.getElementById('name').value,
        avatar: document.getElementById('avatar').value,
        fb_main: document.getElementById('fb_main').value,
        fb_sub: document.getElementById('fb_sub').value,
        zalo: document.getElementById('zalo').value,
        website: document.getElementById('website').value,
        services: document.getElementById('services').value.split(',').map(s => s.trim()),
        insurance_amount: Number(document.getElementById('insurance_amount').value),
        insurance_date: document.getElementById('insurance_date').value,
        note: document.getElementById('note').value,
        bank_accounts: {}
      };

      const rawBanks = document.getElementById('bank_accounts').value.trim().split('\n');
      rawBanks.forEach(line => {
        const [bank, acc] = line.split(':').map(x => x.trim());
        if (bank && acc) data.bank_accounts[bank.toLowerCase()] = acc;
      });

      db.collection("gdv_list").add(data)
        .then(() => {
          alert("âœ… ThÃªm GDV thÃ nh cÃ´ng!");
          document.querySelectorAll("input, textarea").forEach(el => el.value = "");
        })
        .catch(err => alert("âŒ Lá»—i: " + err.message));
    }
  </script>
</body>
</html>
